using FastPKSim
using Test

@testset "FastPKSim.jl" begin
    # Input data example
    θ = [0.004379828
    0.0036190297
    0.0015290421
    0.0012518701
    8.4043735f-5
    6.7705884]

    # Infusion rates
    u = [0.13888334
        0.13888334
        0.13888334
        0.13888334
        0.13888334
        0.13888334
        0.13888334
        0.13888334
        0.13888334
        0.25
        0.11111667
        0.11111667
        0.11111667
        0.11111667
        0.11111667
        0.11111667
        0.0
        0.0
        0.0
        0.0
        0.0]

    # Bolus doses
    v = [
        130.0
        0.0
        0.0
        0.0
        0.0
        0.0
        0.0
        0.0
        0.0
        0.0
        0.0
        0.0
        0.0
        0.0
        0.0
        0.0
        0.0
        0.0
        0.0
        0.0
        0.0]

    hs = [
        60.0
        60.0
        60.0
        120.0
        300.0
        300.0
        300.0
        600.0
        300.0
            0.08642578
        299.91357
        300.0
        300.0
        600.0
        900.0
        899.8379
        300.1621
        600.0
        900.0
        1800.0
        1800.0]

    youts = [
        2
        3
        4
        5
        6
        7
        8
        9
        12
        13
        14
        15
        16
        18
        19
        20
        21]

    # Test 
    y = zeros(Float32,length(youts))
    pk3sim!(y, θ, u, v, hs, youts, order = 3)

    # True output
    ytrue = [11.88856
        7.898715
        5.72578
        3.9100208
        3.2476592
        3.2881098
        3.3521297
        3.457583
        3.1101177
        3.0752244
        3.0635502
        3.0553818
        3.064428
        1.3802555
        0.95433724
        0.64292
        0.38235474]

    @test y ≈ ytrue

end
